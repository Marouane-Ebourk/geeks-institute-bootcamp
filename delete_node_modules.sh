#!/bin/bash

# Default to current directory if no argument is provided
if [ $# -gt 0 ]; then
    target_dir="$1"
else
    target_dir="$(pwd)"
fi

echo "Searching for node_modules folders in: $target_dir"

find_node_modules_folders() {
    # echo "Searching in: $1" >&2  # Send to stderr
    local path="$1"
    
    if [ ! -d "$path" ] || [ ! -r "$path" ]; then
        return
    fi
    
    for dir in "$path"/*; do
        # echo "Checking: $dir" >&2  # Send to stderr
        [ ! -d "$dir" ] && continue
        
        local dirname=$(basename "$dir")
        # echo "$dirname" >&2  # Send to stderr
        
        if [ "$dirname" = "node_modules" ]; then
            echo "$dir"
            continue
        fi
        
        # reccursion
        find_node_modules_folders "$dir"
    done
}

# Find all node_modules folders
echo "Finding node_modules folders..."
node_modules_folders=($(find_node_modules_folders "$target_dir"))


# Delete found folders
for folder in "${node_modules_folders[@]}"; do
    if [ -d "$folder" ]; then
        echo "Deleting: $folder"
        rm -rf "$folder" 2>/dev/null
    fi
done

echo "Deletion complete."