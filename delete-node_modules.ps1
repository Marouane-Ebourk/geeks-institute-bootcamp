# Default to current directory if no argument is provided
$targetDir = if ($args.Count -gt 0) { $args[0] } else { Get-Location }

Write-Host "Searching for node_modules folders in: $targetDir"

# Custom function to recursively find node_modules folders, skipping their contents
function Find-NodeModulesFolders {
    param([string]$Path)
    $results = @()
    $dirs = Get-ChildItem -Path $Path -Directory -Force -ErrorAction SilentlyContinue
    foreach ($dir in $dirs) {
        if ($dir.Name -eq "node_modules") {
            $results += $dir.FullName
            # Do not recurse into this directory
            continue
        }
        # Recurse into subdirectories
        $results += Find-NodeModulesFolders -Path $dir.FullName
    }
    return $results
}

$folders = Find-NodeModulesFolders -Path $targetDir

foreach ($folder in $folders) {
    Write-Host "Deleting: $($folder)"
    Remove-Item -Path $folder -Recurse -Force -ErrorAction SilentlyContinue
}

Write-Host "All node_modules folders deleted."
